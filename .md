beautytime-gateway/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ users/
â”‚   â”‚   â”‚   â””â”€â”€ User.controller.ts
â”‚   â”‚   â”œâ”€â”€ notifications/
â”‚   â”‚   â”‚   â””â”€â”€ Notification.controller.ts
â”‚   â”‚   â””â”€â”€ otp/
â”‚   â”‚       â””â”€â”€ OTP.controller.ts
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ users/
â”‚   â”‚   â”‚   â””â”€â”€ User.service.ts
â”‚   â”‚   â”œâ”€â”€ notifications/
â”‚   â”‚   â”‚   â”œâ”€â”€ Notification.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ channels/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Email.channel.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WhatsApp.channel.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SMS.channel.ts
â”‚   â”‚   â”‚   â””â”€â”€ templates/
â”‚   â”‚   â”‚       â”œâ”€â”€ OTP.template.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ Welcome.template.ts
â”‚   â”‚   â”‚       â””â”€â”€ Reminder.template.ts
â”‚   â”‚   â””â”€â”€ otp/
â”‚   â”‚       â””â”€â”€ OTP.service.ts
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ User.model.ts
â”‚   â”‚   â”œâ”€â”€ Notification.model.ts
â”‚   â”‚   â”œâ”€â”€ OTP.model.ts
â”‚   â”‚   â””â”€â”€ VerifiedEmail.model.ts
â”‚   â”œâ”€â”€ interfaces/
â”‚   â”‚   â”œâ”€â”€ User.interface.ts
â”‚   â”‚   â”œâ”€â”€ Notification.interface.ts
â”‚   â”‚   â””â”€â”€ OTP.interface.ts
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ users.routes.ts
â”‚   â”‚   â”œâ”€â”€ notifications.routes.ts
â”‚   â”‚   â””â”€â”€ otp.routes.ts
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.middleware.ts
â”‚   â”‚   â”œâ”€â”€ validation.middleware.ts
â”‚   â”‚   â””â”€â”€ otp.middleware.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ AppError.ts
â”‚   â”‚   â”œâ”€â”€ httpClient.ts
â”‚   â”‚   â””â”€â”€ logger.ts
â”‚   â””â”€â”€ config/
â”‚       â”œâ”€â”€ database.ts
â”‚       â””â”€â”€ environment.ts
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json




ğŸ”„ RESUMO DOS FLUXOS DO SISTEMA
1. FLUXO DE REGISTRO DE USUÃRIO
text
1. Cliente â†’ POST /api/users/register
2. User Service â†’ Valida dados + cria usuÃ¡rio (status: pending)
3. User Service â†’ Dispara OTP via Notification Service
4. Notification Service â†’ Envia email com cÃ³digo OTP
5. Cliente â†’ Recebe email + insere cÃ³digo OTP
6. OTP Service â†’ Verifica cÃ³digo + marca email como verificado
7. User Service â†’ Atualiza usuÃ¡rio para "active"
8. Notification Service â†’ Envia email de boas-vindas multi-canal
2. FLUXO DE LOGIN SEGURO
text
1. Cliente â†’ POST /api/users/login (email + senha)
2. User Service â†’ Verifica credenciais + gera JWT
3. Se 2FA ativo â†’ OTP Service â†’ Envia cÃ³digo por email/SMS
4. Cliente â†’ Insere cÃ³digo OTP (se 2FA)
5. OTP Service â†’ Valida cÃ³digo â†’ Retorna sucesso
6. User Service â†’ Retorna token JWT + dados usuÃ¡rio
3. FLUXO DE NOTIFICAÃ‡Ã•ES MULTI-CANAL
text
1. Qualquer serviÃ§o â†’ POST /api/notifications/send
2. Notification Service â†’ Roteia para canal especÃ­fico
3. Canal (Email/WhatsApp/SMS) â†’ Processa template + envia
4. Sistema â†’ Log da notificaÃ§Ã£o + status
5. Cliente â†’ Recebe notificaÃ§Ã£o no canal escolhido
4. FLUXO DE COMUNICAÃ‡ÃƒO INTERNA ENTRE SERVIÃ‡OS
text
User Service â”€â”€â”¬â”€â”€â–¶ OTP Service (via /api/internal/notifications/otp)
               â””â”€â”€â–¶ Notification Service (via /api/internal/notifications/welcome)

- Todos no mesmo gateway
- ComunicaÃ§Ã£o via HTTP interno
- Fallback graceful se serviÃ§o indisponÃ­vel
5. FLUXO DE RECUPERAÃ‡ÃƒO DE SENHA
text
1. Cliente â†’ POST /api/users/forgot-password (email)
2. User Service â†’ Gera token JWT temporÃ¡rio
3. Notification Service â†’ Envia email com link de reset
4. Cliente â†’ Clica link + nova senha
5. User Service â†’ Valida token + atualiza senha
6. Notification Service â†’ ConfirmaÃ§Ã£o de senha alterada
6. FLUXO DE AGENDAMENTO (EXEMPLO DE USO)
text
1. Cliente â†’ Agenda serviÃ§o (futuro)
2. Sistema â†’ Dispara notificaÃ§Ã£o de confirmaÃ§Ã£o
3. 24h antes â†’ Notification Service â†’ Lembrete (Email + WhatsApp)
4. 1h antes â†’ Notification Service â†’ Lembrete (SMS)
5. ApÃ³s serviÃ§o â†’ Notification Service â†’ Solicita avaliaÃ§Ã£o
ğŸ¯ CARACTERÃSTICAS PRINCIPAIS
ResiliÃªncia
Failover entre canais: Se email falhar, tenta WhatsApp

Retry automÃ¡tico: Tentativas em caso de falha

Circuit breaker: Previne cascata de falhas

Escalabilidade
Gateway Ãºnico: Todas as rotas centralizadas

ServiÃ§os independentes: Podem escalar separadamente

AdiÃ§Ã£o fÃ¡cil de canais: Novo canal = nova classe

SeguranÃ§a
JWT para autenticaÃ§Ã£o

OTP para verificaÃ§Ã£o

Rate limiting em endpoints crÃ­ticos

ValidaÃ§Ã£o de dados em todas as entradas

Monitoramento
Logs estruturados para todos os serviÃ§os

MÃ©tricas de entrega por canal

Status de saÃºde de cada serviÃ§o

ğŸ”€ FLUXOS DE EXCEÃ‡ÃƒO
Quando um serviÃ§o estÃ¡ indisponÃ­vel:
text
User Service â†’ Notification Service (indisponÃ­vel)
â””â”€â”€ Continua operaÃ§Ã£o sem notificaÃ§Ã£o
â””â”€â”€ Log do erro para debugging
â””â”€â”€ UsuÃ¡rio nÃ£o Ã© impactado
Quando um canal falha:
text
Notification Service â†’ Email (falha)
â””â”€â”€ Tenta WhatsApp (fallback)
â””â”€â”€ Se todos falharem â†’ Log do erro
â””â”€â”€ OperaÃ§Ã£o principal continua
ğŸª BENEFÃCIOS DA ARQUITETURA
âœ… Desacoplamento: ServiÃ§os independentes

âœ… ManutenÃ§Ã£o: AtualizaÃ§Ãµes sem downtime

âœ… Testabilidade: Cada serviÃ§o testÃ¡vel isoladamente

âœ… EvoluÃ§Ã£o: Novos recursos sem refator massivo

âœ… Observabilidade: Monitoramento individual por serviÃ§o

O sistema estÃ¡ preparado para crescer de forma organizada e resiliente! ğŸš€

This response is AI-generated, for reference only.


1. ğŸ‘¤ Auth Service cria usuÃ¡rio (status: PENDING_VERIFICATION)
   â””â”€â”€ Chama: POST /notifications/send-verification-email

2. ğŸ“§ Notification Service:
   â”œâ”€â”€ Gera OTP de 6 dÃ­gitos
   â”œâ”€â”€ Salva no banco (OTPModel)
   â”œâ”€â”€ Envia email REAL com template profissional
   â””â”€â”€ Retorna success para Auth Service

3. ğŸ“± Frontend mostra tela de digitar OTP
   â””â”€â”€ UsuÃ¡rio recebe email e digita cÃ³digo

4. âœ… Frontend valida OTP:
   â””â”€â”€ Chama: POST /notifications/verify-email-otp

5. ğŸ” Notification Service:
   â”œâ”€â”€ Valida OTP (cÃ³digo, expiraÃ§Ã£o, tentativas)
   â”œâ”€â”€ Marca email como verificado (VerifiedEmailModel)
   â”œâ”€â”€ Notifica Auth Service via webhook
   â””â”€â”€ Retorna success para Frontend

6. ğŸ‰ Auth Service ativa conta:
   â”œâ”€â”€ Atualiza status para VERIFIED
   â”œâ”€â”€ Chama: POST /notifications/send-welcome-email
   â””â”€â”€ UsuÃ¡rio pode fazer login