beautytime-gateway/
├── src/
│   ├── controllers/
│   │   ├── users/
│   │   │   └── User.controller.ts
│   │   ├── notifications/
│   │   │   └── Notification.controller.ts
│   │   └── otp/
│   │       └── OTP.controller.ts
│   ├── services/
│   │   ├── users/
│   │   │   └── User.service.ts
│   │   ├── notifications/
│   │   │   ├── Notification.service.ts
│   │   │   ├── channels/
│   │   │   │   ├── Email.channel.ts
│   │   │   │   ├── WhatsApp.channel.ts
│   │   │   │   └── SMS.channel.ts
│   │   │   └── templates/
│   │   │       ├── OTP.template.ts
│   │   │       ├── Welcome.template.ts
│   │   │       └── Reminder.template.ts
│   │   └── otp/
│   │       └── OTP.service.ts
│   ├── models/
│   │   ├── User.model.ts
│   │   ├── Notification.model.ts
│   │   ├── OTP.model.ts
│   │   └── VerifiedEmail.model.ts
│   ├── interfaces/
│   │   ├── User.interface.ts
│   │   ├── Notification.interface.ts
│   │   └── OTP.interface.ts
│   ├── routes/
│   │   ├── users.routes.ts
│   │   ├── notifications.routes.ts
│   │   └── otp.routes.ts
│   ├── middleware/
│   │   ├── auth.middleware.ts
│   │   ├── validation.middleware.ts
│   │   └── otp.middleware.ts
│   ├── utils/
│   │   ├── AppError.ts
│   │   ├── httpClient.ts
│   │   └── logger.ts
│   └── config/
│       ├── database.ts
│       └── environment.ts
├── package.json
└── tsconfig.json




🔄 RESUMO DOS FLUXOS DO SISTEMA
1. FLUXO DE REGISTRO DE USUÁRIO
text
1. Cliente → POST /api/users/register
2. User Service → Valida dados + cria usuário (status: pending)
3. User Service → Dispara OTP via Notification Service
4. Notification Service → Envia email com código OTP
5. Cliente → Recebe email + insere código OTP
6. OTP Service → Verifica código + marca email como verificado
7. User Service → Atualiza usuário para "active"
8. Notification Service → Envia email de boas-vindas multi-canal
2. FLUXO DE LOGIN SEGURO
text
1. Cliente → POST /api/users/login (email + senha)
2. User Service → Verifica credenciais + gera JWT
3. Se 2FA ativo → OTP Service → Envia código por email/SMS
4. Cliente → Insere código OTP (se 2FA)
5. OTP Service → Valida código → Retorna sucesso
6. User Service → Retorna token JWT + dados usuário
3. FLUXO DE NOTIFICAÇÕES MULTI-CANAL
text
1. Qualquer serviço → POST /api/notifications/send
2. Notification Service → Roteia para canal específico
3. Canal (Email/WhatsApp/SMS) → Processa template + envia
4. Sistema → Log da notificação + status
5. Cliente → Recebe notificação no canal escolhido
4. FLUXO DE COMUNICAÇÃO INTERNA ENTRE SERVIÇOS
text
User Service ──┬──▶ OTP Service (via /api/internal/notifications/otp)
               └──▶ Notification Service (via /api/internal/notifications/welcome)

- Todos no mesmo gateway
- Comunicação via HTTP interno
- Fallback graceful se serviço indisponível
5. FLUXO DE RECUPERAÇÃO DE SENHA
text
1. Cliente → POST /api/users/forgot-password (email)
2. User Service → Gera token JWT temporário
3. Notification Service → Envia email com link de reset
4. Cliente → Clica link + nova senha
5. User Service → Valida token + atualiza senha
6. Notification Service → Confirmação de senha alterada
6. FLUXO DE AGENDAMENTO (EXEMPLO DE USO)
text
1. Cliente → Agenda serviço (futuro)
2. Sistema → Dispara notificação de confirmação
3. 24h antes → Notification Service → Lembrete (Email + WhatsApp)
4. 1h antes → Notification Service → Lembrete (SMS)
5. Após serviço → Notification Service → Solicita avaliação
🎯 CARACTERÍSTICAS PRINCIPAIS
Resiliência
Failover entre canais: Se email falhar, tenta WhatsApp

Retry automático: Tentativas em caso de falha

Circuit breaker: Previne cascata de falhas

Escalabilidade
Gateway único: Todas as rotas centralizadas

Serviços independentes: Podem escalar separadamente

Adição fácil de canais: Novo canal = nova classe

Segurança
JWT para autenticação

OTP para verificação

Rate limiting em endpoints críticos

Validação de dados em todas as entradas

Monitoramento
Logs estruturados para todos os serviços

Métricas de entrega por canal

Status de saúde de cada serviço

🔀 FLUXOS DE EXCEÇÃO
Quando um serviço está indisponível:
text
User Service → Notification Service (indisponível)
└── Continua operação sem notificação
└── Log do erro para debugging
└── Usuário não é impactado
Quando um canal falha:
text
Notification Service → Email (falha)
└── Tenta WhatsApp (fallback)
└── Se todos falharem → Log do erro
└── Operação principal continua
🎪 BENEFÍCIOS DA ARQUITETURA
✅ Desacoplamento: Serviços independentes

✅ Manutenção: Atualizações sem downtime

✅ Testabilidade: Cada serviço testável isoladamente

✅ Evolução: Novos recursos sem refator massivo

✅ Observabilidade: Monitoramento individual por serviço

O sistema está preparado para crescer de forma organizada e resiliente! 🚀

This response is AI-generated, for reference only.


1. 👤 Auth Service cria usuário (status: PENDING_VERIFICATION)
   └── Chama: POST /notifications/send-verification-email

2. 📧 Notification Service:
   ├── Gera OTP de 6 dígitos
   ├── Salva no banco (OTPModel)
   ├── Envia email REAL com template profissional
   └── Retorna success para Auth Service

3. 📱 Frontend mostra tela de digitar OTP
   └── Usuário recebe email e digita código

4. ✅ Frontend valida OTP:
   └── Chama: POST /notifications/verify-email-otp

5. 🔐 Notification Service:
   ├── Valida OTP (código, expiração, tentativas)
   ├── Marca email como verificado (VerifiedEmailModel)
   ├── Notifica Auth Service via webhook
   └── Retorna success para Frontend

6. 🎉 Auth Service ativa conta:
   ├── Atualiza status para VERIFIED
   ├── Chama: POST /notifications/send-welcome-email
   └── Usuário pode fazer login